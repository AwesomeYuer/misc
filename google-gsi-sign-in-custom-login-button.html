<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="Generator" content="EditPlus速,Microshaoft">
	<meta name="Author" content="EditPlus速,Microshaoft">
	<meta name="Keywords" content="EditPlus速,Microshaoft">
	<meta name="Description" content="EditPlus速,Microshaoft">
	<title>google-gsi-sign-in-custom-login-button</title>
    <script src="https://accounts.google.com/gsi/client"></script>
</head>
<body>
    <button onclick="handleGoogleLogin()">
        Login with new Google Sign-in
    </button>
    
    <br />
    <br />
    <br />
    <br />

    <script>

        function parseJwt (token) {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        const googleSignedInCallback = (response) => {
            // handle JWT token inside response...
            // https://developers.google.com/identity/gsi/web/guides/handle-credential-responses-js-functions#handle_credential_response
            var r = parseJwt(response.credential);
            alert(JSON.stringify(r, null, 2));

            document.getElementById("output").innerHTML = "<pre>" +  JSON.stringify(r, null, 2) + "</pre>";


        };

        // https://developers.google.com/identity/gsi/web/reference/js-reference#IdConfiguration
        google.accounts.id.initialize({
            client_id: "944301045116-usq3bf0h2algmn9g39gp34qobs82171v.apps.googleusercontent.com",
            ux_mode: "popup",
            callback: googleSignedInCallback,
        });

        const createFakeGoogleWrapper = () => {
        const googleLoginWrapper = document.createElement("div");
        // Or you can simple hide it in CSS rule for custom-google-button
        //googleLoginWrapper.style.display = "none";
        //googleLoginWrapper.classList.add("custom-google-button");

        // Add the wrapper to body
        document.body.appendChild(googleLoginWrapper);
        
        // Use GSI javascript api to render the button inside our wrapper
        // You can ignore the properties because this button will not appear
        google.accounts.id.renderButton(googleLoginWrapper, {
            // type: "icon",
            // width: "200",
        });

        const googleLoginWrapperButton =
            googleLoginWrapper.querySelector("div[role=button]");

        return {
            click: () => {
                googleLoginWrapperButton.click();
            },
        };
        };

        // Now we have a wrapper to click
        const googleButtonWrapper = createFakeGoogleWrapper();

        handleGoogleLogin = () => {
            // Use wrapper click to prevent Illegal invocation exception
            googleButtonWrapper.click();
            // This will open GSI login and after success you will have
            // a response on googleLoginCallback method previously created
        };

    </script>

    <div id="output">


    </div>


</body>
</html>
